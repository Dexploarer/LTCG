---
/**
 * CardBrowserWrapper - Astro component that fetches card data at build time
 * and passes it to the interactive React CardBrowser component.
 */
import { getCollection, type CollectionEntry } from 'astro:content';
import CardBrowser from './CardBrowser';

// Fetch all cards from the content collection at build time
const cardsCollection = await getCollection('cards');

// Transform to the format expected by CardBrowser
const cards = cardsCollection.map((entry: CollectionEntry<'cards'>) => ({
  id: entry.id,
  cardNumber: entry.data.cardNumber,
  name: entry.data.name,
  rarity: entry.data.rarity,
  cardType: entry.data.cardType,
  archetype: entry.data.archetype,
  monsterStats: entry.data.monsterStats,
  effects: entry.data.effects,
}));
---

{cards.length > 0 ? (
  <CardBrowser client:load cards={cards} />
) : (
  <div class="no-cards-message">
    <p><strong>Card database not loaded.</strong></p>
    <p>Card data is fetched from Convex at build time. To see cards:</p>
    <ol>
      <li>Set the <code>PUBLIC_CONVEX_URL</code> environment variable</li>
      <li>Ensure the Convex backend has card data</li>
      <li>Rebuild the wiki: <code>bun run build</code></li>
    </ol>
    <p>See <a href="/getting-started/quick-start/">Quick Start</a> for setup instructions.</p>
  </div>
)}

<style>
  .no-cards-message {
    background: var(--sl-color-gray-6);
    padding: 2rem;
    border-radius: 0.5rem;
    border-left: 4px solid var(--sl-color-accent);
  }

  .no-cards-message code {
    background: var(--sl-color-gray-5);
    padding: 0.125rem 0.375rem;
    border-radius: 0.25rem;
    font-size: 0.875rem;
  }

  .no-cards-message ol {
    margin: 1rem 0;
    padding-left: 1.5rem;
  }

  .no-cards-message li {
    margin: 0.5rem 0;
  }
</style>
